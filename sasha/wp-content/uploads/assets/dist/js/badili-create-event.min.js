app.controller('createEventCtrl', function ($scope,$rootScope) {

    //enable jquery validate for this form now that its data is loaded
    $scope.enableEventFormValidate();
    //console.log('Initiating the controllers');

    $scope.createEvent = function () {
        $scope.post_content = $('#tribe_event_details_ifr').contents().find("body").html();

        $scope.EventStartDate = $('#EventStartDate').val();
        $scope.EventStartTime = $('#EventStartTime').val();
        $scope.EventEndDate = $('#EventEndDate').val();
        $scope.EventEndTime = $('#EventEndTime').val();
        $scope.EventAllDay = $('#EventAllDay').val();
        $scope.event_url = $('#event_url').val();
        $scope.currency_symbol = $('#currency_symbol').val();
        $scope.event_cost = $('#event_cost').val();
        $scope.venue_address = $('#venue_address').val();
        $scope.venue_city = $('#venue_city').val();
        $scope.venue_country = $('#venue_country').val();
      

       if ($("#EventDetailsForm").valid()) {
            var data = {
                action: "create_my_event",
                post_title: $scope.event_title,
                post_content: $scope.post_content,
                event_start_date: $scope.EventStartDate,
                event_start_time: $scope.EventStartTime,
                event_end_date: $scope.EventEndDate,
                event_end_time: $scope.EventEndTime,
                all_day_event: $scope.EventAllDay,
                event_url: $scope.event_url,
                currency_symbol: $scope.currency_symbol,
                venue_address: $scope.venue_address,
                venue_city: $scope.venue_city,
                venue_country: $scope.venue_country,
                event_cost: $scope.event_cost,
                topics: JSON.stringify($rootScope.final_topics),
                topics_tax: JSON.stringify($rootScope.topics_tax),
            };
            
            $scope.send_ajax_request(data, function (response) {
                if (response.status == "success") {
                    $scope.post_title = "";
                    $scope.post_content = "";
                    $scope.EventStartDate = "";
                    $scope.EventStartTime = "";
                    $scope.EventEndDate ="";
                    $scope.EventEndTime = "";
                    $scope.EventAllDay = "";
                    $scope.venue_address = "";
                    $scope.venue_city = "";
                    $scope.venue_country = "";
                    $scope.event_cost = "";
                    $scope.currency_symbol = "";
                    $scope.event_url = "";


                    $('#tribe_event_details_ifr').contents().find("body").html("");

                    $('#EventStartDate').val("");
                    $('#EventStartTime').val("");
                    $('#EventEndDate').val("");
                    $('#EventEndTime').val("");
                    $('#EventAllDay').val("");
                    $('#event_url').val("");
                    $('#currency_symbol').val("");
                    $('#event_cost').val("");
                    $('#venue_address').val("");
                    $('#venue_city').val("");
                    $('#venue_country').val("");
                    

                    $scope.safeApply();

                    window.location.href = response.url;
                }
            }, function (error) {
                console.log("Error", error);
            });
        }

    };
});