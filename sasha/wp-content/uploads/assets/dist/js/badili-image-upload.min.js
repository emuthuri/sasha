app.controller("imageVideoUploadCtrl",["$scope","$rootScope",function(a,b){a.uploadFile=function(){if($("#ImageDetailsForm").valid()){var c={action:"upload_document",title:a.title,"abstract":a["abstract"],credits:a.credits,language:a.language,filesize:a.filesizebytes,filename:a.filename,filetype:a.filetype,filedata:a.filedata,topics:JSON.stringify(b.final_topics),topics_tax:JSON.stringify(b.topics_tax)};a.send_ajax_request(c,function(a){"success"==a.status&&(window.location.href=a.url)},function(a){console.log("Error",a)})}},$(document).on("change","input[type=file]",function(){var b=$(this).attr("id"),c=$(this)[0].files[0];switch(b){case"image-select":a.uploadTheFile(c,function(b,d,e){if("success"==b){var f={action:"get_document_meta",filename:c.name,filedata:d,filetype:c.type};a.send_ajax_request(f,function(b){"success"==b.status&&($("#number_of_pages").closest(".form-group").addClass("hidden"),/image\/*/.test(c.type)&&(a.creation_date=b.meta.DateTimeOriginal?a.get_value(b.meta.DateTimeOriginal).toDate("yyyy-mm-dd hh:ii:ss"):"",$('[name="image_authors"]').val(a.get_value(b.meta.Author)),a.title=a.get_value(b.meta.Title)),a.filedata=d,a.filename=c.name,a.filetype=c.type,a.filesize=a.bytesToMbs(c.size),a.filesizebytes=c.size,a.safeApply())},function(a){console.log("Error",a)})}else"failure"==b&&console.log("Failure","Upload failed: "+e)})}})}]);